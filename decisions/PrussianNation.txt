#Moving forming decisions to BtPLReplaceVanillaCountryFormations

#I normally don't like messing with vanilla files when I don't have to, but between all the map changes and the fact that I wanted to clean up a few things
#and make everything more dynamic anyway, I figured I'd just reorganise. Hope this doesn't mess with anyone too much. - Draiocht

country_decisions = {
	# institute_prussian_republic = {
		# major = yes
		# potential = {
			# always = no
			# NOT = {
				# OR = {
					# has_dlc = "Dharma"
					# has_dlc = "Emperor"
				# }
			# }
			# normal_or_historical_nations = yes
			# tag = PRU
			# government = republic
			# NOT = { has_reform = prussian_republic }
		# }

		# allow = {
			# is_revolutionary = no
			# OR = {
				# religion = protestant
				# religion = reformed
				# religion = hussite
				# religion = anglican
			# }
		# }

		# effect = {
			# add_government_reform = prussian_republic
		# }
	# }

	# institute_prussian_monarchy = {
		# major = yes
		# potential = {
			# always = no
			# NOT = {
				# OR = {
					# has_dlc = "Dharma"
					# has_dlc = "Emperor"
				# }
			# }
			# normal_or_historical_nations = yes
			# tag = PRU
			# government = monarchy
			# NOT = { has_reform = prussian_monarchy_legacy }
		# }

		# allow = {
			# is_revolutionary = no
			# OR = {
				# religion = protestant
				# religion = reformed
				# religion = hussite
				# religion = anglican
			# }
		# }

		# effect = {
			# add_government_reform = prussian_monarchy
		# }
	# }

	form_kingdom_of_prussia = { #BRA
		major = yes
		potential = {
			bt_generic_can_form_potential_check = yes
			NOT = { has_country_flag = formed_prussia_flag }
			NOT = { tag = PRU }
			NOT = { tag = GER }
			tag = BRA
		}
		provinces_to_highlight = {
			OR = {
				province_id = 41	# Königsberg
				AND = {
					province_id = 43	# Danzig
					ROOT = { NOT = { owns_core_province = 2995 } }
				}
				AND = {
					province_id = 2995
					ROOT = { NOT = { owns_core_province = 43 } }
				}
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		allow = {
			NOT = { exists = PRU }
			is_nomad = no
			is_free_or_tributary_trigger = yes			
			OR = { #Readded to all of these otherwise its too easy for players
				religion = reformed
				religion = protestant
			}
			is_at_war = no
			owns_core_province = 41			# Königsberg
			OR = {
				owns_core_province = 43		# Danzig
				owns_core_province = 2995	# Stolp
			}
			total_development = 150			#Normal requirement for rank 2 is 500 dev, so this is 70 percent discounted
			prestige = 25			#Normal requirement for rank 2 is 50 prestige, so this is 50 percent discounted
		}
		effect = {
			change_tag = PRU
			restore_country_name_effect = yes
			swap_non_generic_missions = yes
			remove_non_electors_emperors_from_empire_effect = yes
			if =  {
				limit = {
					NOT = {
						government = republic
					}
				}
				change_government_to_monarchy = yes
				add_government_reform = prussian_monarchy
			}
			else = {
				add_government_reform = prussian_republic_reform
			}
			if = {
				limit = {
					has_reform = states_general_reform
				}
				remove_government_reform = states_general_reform
			}
			if = {
				limit = {
					OR = {
						NOT = { has_dlc = "Emperor" }
						NOT = { hre_size = 1 }
					}
					NOT = { government_rank = 2 }
				}
				set_government_rank = 2
			}
			add_country_modifier = {
				name = centralization_modifier
				duration = 7300
			}
			add_prestige = 25
			change_primary_culture = prussian
			PRU = {
				random_owned_province = {
					limit = { 
						OR = {
							culture = saxon
							culture = pommeranian
							culture = markish
						}
					} 
					change_culture = prussian
				}
			}				#The special thing about this decision, apparently. Monastic TEU gets relation change instead with neighbours
			west_prussia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			east_prussia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			masuria_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			nadruvia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			if = {
				limit = {
					NOT = { has_idea_group = PRU_ideas }
				}
				swap_ideas = yes
			}
			set_country_flag = formed_prussia_flag
		}
		ai_will_do = {
			factor = 1
		}
		ai_importance = 400 #
	}

	prussian_nation = { #TEU
		major = yes
		potential = {
			bt_generic_can_form_potential_check = yes
			NOT = { has_country_flag = formed_prussia_flag }
			NOT = { tag = PRU }
			NOT = { tag = GER }
			tag = TEU
			has_reform = monastic_order_reform
		}
		provinces_to_highlight = {
			OR = {
				province_id = 41	# Königsberg
				AND = {
					province_id = 43	# Danzig
					ROOT = { NOT = { owns_core_province = 2995 } }
				}
				AND = {
					province_id = 2995
					ROOT = { NOT = { owns_core_province = 43 } }
				}
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		allow = {
			NOT = { exists = PRU }
			is_nomad = no
			is_free_or_tributary_trigger = yes
			OR = { #Readded to all of these otherwise its too easy for players
				religion = reformed
				religion = protestant
			}
			is_at_war = no
			owns_core_province = 41			# Königsberg
			OR = {
				owns_core_province = 43		# Danzig
				owns_core_province = 2995	# Stolp
			}
			total_development = 150			#Normal requirement for rank 2 is 500 dev, so this is 70 percent discounted
			prestige = 25			#Normal requirement for rank 2 is 50 prestige, so this is 50 percent discounted
		}
		effect = {
			41 = {
				move_capital_effect = yes
			}
			change_tag = PRU
			restore_country_name_effect = yes
			swap_non_generic_missions = yes
			remove_non_electors_emperors_from_empire_effect = yes
			change_government = monarchy
			add_government_reform = prussian_monarchy
			if = {
				limit = {
					has_reform = states_general_reform
				}
				remove_government_reform = states_general_reform
			}
			# if = {
				# limit = { NOT = { government_rank = 2 } }
				# set_government_rank = 2
			# }
			add_country_modifier = {
				name = centralization_modifier
				duration = 7300
			}
			add_prestige = 25
			change_primary_culture = prussian
			every_neighbor_country = {
				limit = { government = monarchy }
				add_opinion = { who = ROOT modifier = secularized_monastic_order }
			}				#The special thing about this decision, apparently, instead of auto culture-flip
			west_prussia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			east_prussia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			masuria_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			nadruvia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			if = {
				limit = {
					NOT = { has_idea_group = PRU_ideas }
				}
				swap_ideas = yes
			}
			set_country_flag = formed_prussia_flag
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { is_year = 1525 }
			}
		}
		ai_importance = 400 #
	}

	prussian_nation_general = { #General Prus
		major = yes
		potential = {
			bt_generic_can_form_potential_check = yes
			NOT = { has_country_flag = formed_prussia_flag }
			NOT = { tag = PRU }
			NOT = { tag = GER }
			NOT = { tag = HLR }
			OR = {
				primary_culture = pommeranian
				primary_culture = saxon
				primary_culture = prussian
			}
			NOT = { tag = BRA }
			OR = {
				AND = {
					tag = TEU
					NOT = { has_reform = monastic_order_reform }
				}
				NOT = { tag = TEU }
			}
			owns_core_province = 41			# Königsberg
			num_of_cities = 12			#If not one of the normal candidates, needs 12 provinces plus Koenigsberg to see
		}
		provinces_to_highlight = {
			OR = {
				province_id = 41	# Königsberg
				province_id = 43	# Danzig
				province_id = 2995	# Stolp
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		allow = {
			NOT = { exists = PRU }
			is_nomad = no
			is_free_or_tributary_trigger = yes
			is_at_war = no
			OR = { #Re-adding this religion thingy for this one specifically.
				religion = reformed
				religion = protestant
			}
			owns_core_province = 41			# Königsberg
			owns_core_province = 43		# Danzig
			owns_core_province = 2995	# Stolp
			total_development = 150			#Normal requirement for rank 2 is 500 dev, so this is 70 percent discounted
			prestige = 25			#Normal requirement for rank 2 is 50 prestige, so this is 50 percent discounted
		}
		effect = {
			change_tag = PRU
			restore_country_name_effect = yes
			swap_non_generic_missions = yes
			remove_non_electors_emperors_from_empire_effect = yes
			if = {
				limit = {
					OR = {
						NOT = { has_dlc = "Emperor" }
						NOT = { hre_size = 1 }
					}
					NOT = { government_rank = 2 }
				}
				set_government_rank = 2
			}
			if =  {
				limit = {
					NOT = {
						government = republic
					}
				}
				change_government_to_monarchy = yes
				add_government_reform = prussian_monarchy
			}
			else = {
				add_government_reform = prussian_republic_reform
			}
			if = {
				limit = {
					has_reform = states_general_reform
				}
				remove_government_reform = states_general_reform
			}
			if = {
				limit = { NOT = { government_rank = 2 } }
				set_government_rank = 2
			}
			add_country_modifier = {
				name = centralization_modifier
				duration = 3650
			}
			add_prestige = 25
			change_primary_culture = prussian
			capital_scope = {
				change_culture = prussian
			}
			random_owned_province = {
				limit = { 
					OR = {
						culture = saxon
						culture = pommeranian
					}
				} 
				change_culture = prussian
			}
			west_prussia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			east_prussia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			masuria_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			nadruvia_area = { #Moldavia
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = PRU
			}
			if = {
				limit = {
					NOT = { has_idea_group = PRU_ideas }
				}
				swap_ideas = yes
			}
			set_country_flag = formed_prussia_flag
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { is_year = 1525 }
			}
		}
		ai_importance = 400 #
	}
}